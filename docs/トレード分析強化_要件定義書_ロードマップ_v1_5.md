# トレード分析強化 - 要件定義書 & ロードマップ v1.5

**作成日**: 2026-01-16  
**更新日**: 2026-01-16  
**ステータス**: 📋 要件定義完了 → 🚧 実装準備中  
**優先度**: 🔴 CRITICAL（差別化機能）  
**コンセプト**: 「記録するだけ」→「成長できるシステム」  
**準拠**: MODULES.md標準パターン

---

## 📋 目次

1. [概要](#概要)
2. [機能1: 許容損失管理](#機能1-許容損失管理)
3. [機能2: 手法管理](#機能2-手法管理)
4. [機能3: 振り返り強化](#機能3-振り返り強化)
5. [機能4: トレード一覧バッジ](#機能4-トレード一覧バッジ)
6. [機能5: 月次レポート再編成](#機能5-月次レポート再編成)
7. [UI設計](#ui設計)
8. [モジュール設計（MODULES.md準拠）](#モジュール設計modulesmd準拠)
9. [データ構造](#データ構造)
10. [AI参照設計（将来のPro版用）](#ai参照設計将来のpro版用)
11. [実装ロードマップ](#実装ロードマップ)

---

## 概要

### 背景・課題

```
【現在のTrading Complete】
記録 → 統計表示

【課題】
- 許容損失を知らない初心者がそのまま使う
- 何を記録すれば「成長」につながるかわからない
- データはあるが「気づき」につながらない
- 「ルールを守れたか」が可視化されていない


【目指す姿】
記録 → 自動分析 → 気づき → 成長

「このシステムを使えば成長できる」
```

### 核心の考え方

> **「感情でトレードするものではない」**
> **「ルールを守れているかを重視」**

感情の記録ではなく、**ルール遵守**と**リスク管理**にフォーカス。

### 設計思想：なぜリリース前に実装するのか

```
【問題】
「ほぼ完成」でも「役に立ちづらい」
→ システムは最初の印象が大事
→ シンプルは「知識ある人」向け
→ 初心者は「何を見ればいいか」がわからない


【解決策】
システムがデータを自動分析して「気づき」を見せる
→ 初心者でも「これ使える！」と思える
→ 最初の印象で「成長できそう」と感じさせる
```

### AI機能への布石

```
【間違ったAIの使い方】
生データ → AI → 分析結果
（コスト高い、精度低い、毎回課金）


【正しいAIの使い方】
生データ → Trading Completeが分析 → 分析結果 → AI → 洞察
（コスト安い、精度高い、必要な時だけ課金）
```

**今回の実装でデータ分析の土台を作る**
**将来のAI機能追加時に、分析結果をAIに渡すだけで高品質なアドバイスが可能に**

### 実装する機能

| 機能 | 目的 | 効果 |
|------|------|------|
| 許容損失管理 | リスク管理の習慣化 | 資金を守る |
| 手法管理 | 手法別の成績分析 | 得意・不得意の把握 |
| 振り返り強化 | ルール遵守の可視化 | 規律あるトレード |
| バッジ表示 | 一覧での即時把握 | 傾向の気づき |
| レポート再編成 | 本当に欲しい情報 | **これぞレポート** |

---

## 機能1: 許容損失管理

### 1.1 目的

```
「証拠金」は入力したくない（プライバシー）
→ 代わりに「1回の許容損失額」を入力させる
→ 為替レートも入力（全通貨ペア対応）
→ 適正ロットを自動計算
→ 超過時に警告
→ 分析で「守れた/守れなかった」の比較
```

### 1.2 設定画面（設定 → トレーディング）

```
┌─────────────────────────────────────────────────────┐
│ 💰 許容損失管理                                      │
├─────────────────────────────────────────────────────┤
│                                                     │
│ 1回のトレードで許容できる損失額:                     │
│ ┌─────────────────────────────────────────────────┐ │
│ │ [5,000] 円                                      │ │
│ └─────────────────────────────────────────────────┘ │
│                                                     │
│ 💡 ヒント                                           │
│ 証拠金の1〜2%がおすすめです。                        │
│ 例：証拠金50万円 → 5,000〜10,000円                  │
│                                                     │
│ 📊 この設定の効果                                    │
│ ・新規エントリー時に適正ロットを自動計算             │
│ ・超過時にロット数が警告色に変化                    │
│ ・分析タブで「許容損失内/超過」の勝率比較           │
│ ・月次レポートにリスク管理状況を表示                │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 1.3 新規エントリー画面への表示

```
┌─────────────────────────────────────────────────────┐
│ 📊 リスク管理                                        │
├─────────────────────────────────────────────────────┤
│                                                     │
│ 許容損失: 5,000円（設定より）                        │
│                                                     │
│ 通貨ペア: [USD/JPY]  ← 選択済み                     │
│                                                     │
│ 損切り幅: [20] pips                                 │
│                                                     │
│ 決済通貨レート: [1.00] 円  ← 自動設定/手動変更可   │
│ ※ クロス円=1.00、EURUSD等は現在のUSD/JPYレートを入力│
│                                                     │
│ ─────────────────────────────────────────────────── │
│                                                     │
│ 適正ロット: 2.5ロット（自動計算）                   │
│ ※ 1ロット = 10,000通貨                              │
│                                                     │
│ ─────────────────────────────────────────────────── │
│                                                     │
│ 実際のロット: [2.5]   ← ✅ 適正範囲内               │
│               [3.0]   ← ⚠️ 超過（オレンジ）         │
│               [5.0]   ← 🚨 大幅超過（赤）           │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 1.4 計算式

```
【基本式】
適正ロット(通貨) = 許容損失(円) ÷ 損切り幅(円)

【クロス円の場合】（USD/JPY, EUR/JPY等）
損切り幅(円) = 損切り幅(pips) × 0.01
決済通貨レート = 1.00（円建て）

例：許容損失5,000円、損切り20pips
適正ロット = 5,000 ÷ (20 × 0.01) = 5,000 ÷ 0.20 = 25,000通貨


【ドルストレートの場合】（EUR/USD, GBP/USD等）
損切り幅(円) = 損切り幅(pips) × 0.0001 × 決済通貨レート(USD/JPY)

例：許容損失5,000円、損切り20pips、USD/JPY=150円
損切り幅(円) = 20 × 0.0001 × 150 = 0.30円
適正ロット = 5,000 ÷ 0.30 = 16,667通貨


【その他のクロス通貨】（EUR/GBP, AUD/NZD等）
決済通貨のレート（対円）を入力して計算
```

### 1.5 決済通貨レートの自動判定

| 通貨ペア種別 | 決済通貨 | デフォルト値 |
|-------------|---------|-------------|
| クロス円（〇〇/JPY） | JPY | 1.00（固定） |
| ドルストレート（〇〇/USD） | USD | 手動入力（USD/JPYレート） |
| その他（EUR/GBP等） | GBP等 | 手動入力（〇〇/JPYレート） |

### 1.6 警告の閾値

| 状態 | 条件 | 色 | バッジ |
|------|------|-----|--------|
| 適正 | 実際ロット ≤ 適正ロット | 通常（白） | ✅ |
| 注意 | 適正 < 実際 ≤ 適正×2 | オレンジ | ⚠️ |
| 超過 | 実際 > 適正×2 | 赤 | 🚨 |

※ 2倍という基準は計算しやすく、ユーザーも理解しやすい

### 1.7 分析タブでの表示

```
┌─────────────────────────────────────────────────────┐
│ 📊 許容損失と勝率の関係                              │
├─────────────────────────────────────────────────────┤
│                                                     │
│ ✅ 許容損失内のトレード:                            │
│ ├─ 件数: 45件                                      │
│ ├─ 勝率: 58%                                       │
│ ├─ 平均Pips: +12.3                                 │
│ └─ 期待値: +3,500円                                │
│                                                     │
│ 🚨 許容損失超過のトレード:                          │
│ ├─ 件数: 12件                                      │
│ ├─ 勝率: 33%  ← ⚠️ 差に注目！                      │
│ ├─ 平均Pips: -8.5                                  │
│ └─ 期待値: -2,100円                                │
│                                                     │
│ 💡 気づき                                           │
│ 許容損失を守ったトレードの方が勝率が高いです。       │
│ ロットを抑えることで冷静な判断ができています。       │
│                                                     │
└─────────────────────────────────────────────────────┘
```

---

## 機能2: 手法管理

### 2.1 目的

```
「自分の得意な手法」を発見する
→ 手法別の成績を可視化
→ 勝てる手法に集中できる
```

### 2.2 設定画面（設定 → トレーディング）

```
┌─────────────────────────────────────────────────────┐
│ 📋 手法管理                                          │
├─────────────────────────────────────────────────────┤
│                                                     │
│ トレード時に使用した手法を記録できます。              │
│                                                     │
│ 登録済みの手法（3/10）:                              │
│ ┌─────────────────────────────────────────────────┐ │
│ │ [ダウフィボ] ダウ理論×フィボ押し目買い      [×] │ │
│ │  └─ 略称      └─ 正式名                         │ │
│ └─────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────┐ │
│ │ [ブレイク] 水平線ブレイクアウト              [×] │ │
│ └─────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────┐ │
│ │ [TL反発] トレンドライン反発                  [×] │ │
│ └─────────────────────────────────────────────────┘ │
│                                                     │
│ [+ 手法を追加]                                      │
│                                                     │
│ ⚠️ 手法は追加後に編集できません                     │
│ （過去の記録との整合性を保つため）                  │
│ 変更したい場合は削除して新規追加してください。       │
│                                                     │
│ 💡 例                                               │
│ ・ダウ理論×フィボ押し目買い                         │
│ ・移動平均線クロス                                  │
│ ・水平線ブレイクアウト                              │
│ ・トレンドライン反発                                │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 2.3 手法追加モーダル

```
┌─────────────────────────────────────────────────────┐
│ 📋 手法を追加                                 [×]   │
├─────────────────────────────────────────────────────┤
│                                                     │
│ 手法名（正式名）:                                    │
│ ┌─────────────────────────────────────────────────┐ │
│ │ [ダウ理論×フィボ押し目買い                    ] │ │
│ └─────────────────────────────────────────────────┘ │
│ ※ 最大30文字                                        │
│                                                     │
│ 略称（バッジ表示用）:                                │
│ ┌─────────────────────────────────────────────────┐ │
│ │ [ダウフィボ                                   ] │ │
│ └─────────────────────────────────────────────────┘ │
│ ※ 最大10文字（トレード一覧のバッジに表示）          │
│                                                     │
│ メモ（任意）:                                        │
│ ┌─────────────────────────────────────────────────┐ │
│ │ [日足トレンド確認→4H押し目で入る             ] │ │
│ └─────────────────────────────────────────────────┘ │
│ ※ 最大200文字（自分用のメモ）                        │
│                                                     │
│ ⚠️ 追加後は編集できません。よく確認してください。    │
│                                                     │
│               [キャンセル] [追加]                    │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 2.4 新規エントリー画面

```
┌─────────────────────────────────────────────────────┐
│ 📋 使用手法                                          │
├─────────────────────────────────────────────────────┤
│                                                     │
│ [▼ 手法を選択（任意）                        ]      │
│   ├─ （なし）                                       │
│   ├─ ダウ理論×フィボ押し目買い                     │
│   ├─ 水平線ブレイクアウト                          │
│   └─ トレンドライン反発                            │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 2.5 削除時の挙動

```
【重要】削除した手法の扱い

・手法を削除 → その手法を使ったトレードは分析から完全除外
・トレードデータ自体は残る（methodIdは保持される）
・プルダウンから削除された手法は選択肢に表示されない
・削除は取り消せない

理由：
削除した複数の手法を「削除済み」としてまとめると、
異なる手法が混ざって意味のない数字になるため。
```

### 2.6 分析タブでの表示

```
┌─────────────────────────────────────────────────────┐
│ 📊 手法別トレード分析                                │
├─────────────────────────────────────────────────────┤
│                                                     │
│ | 手法                    | 件数 | 勝率 | 平均Pips | 期待値    | PF   |
│ |-------------------------|------|------|----------|-----------|------|
│ | ダウ理論×フィボ押し目    | 25   | 64%  | +18.3    | +5,200円  | 1.85 |
│ | 水平線ブレイクアウト      | 18   | 44%  | +5.2     | +800円    | 1.12 |
│ | トレンドライン反発        | 10   | 50%  | +8.5     | +1,500円  | 1.32 |
│ | （未設定）               | 15   | 40%  | -2.3     | -500円    | 0.85 |
│                                                     │
│ ※ 削除した手法のトレードは集計に含まれません        │
│                                                     │
│ 🔒 Pro版で利用可能                                  │
│ AIによる「気づき」生成機能                          │
│ （例：「この手法に絞ると成績が伸びる可能性」など）  │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 2.7 制限

| 項目 | 値 |
|------|-----|
| 手法上限 | 10個 |
| 手法名（正式名）文字数 | 30文字 |
| 略称文字数 | 10文字 |
| メモ文字数 | 200文字 |
| 編集 | ❌ 不可 |
| 削除 | ✅ 可（分析から除外される）|

---

## 機能3: 振り返り強化

### 3.1 目的

```
決済後の振り返りを「選択式」でデータ化
→ 「ルールを守れたか」を最重視
→ 集計・分析可能に
```

### 3.2 決済時の追加入力項目

```
┌─────────────────────────────────────────────────────┐
│ 📝 振り返り                                          │
├─────────────────────────────────────────────────────┤
│                                                     │
│ ルール通りのトレードでしたか？ ← 最重要             │
│ [YES ○] [NO]                                        │
│                                                     │
│ 決済後にトレンドは続きましたか？（任意）             │
│ [YES] [NO] [未確認 ○]                               │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 3.3 分析タブでの表示

```
┌─────────────────────────────────────────────────────┐
│ 📊 ルール遵守と成績                                  │
├─────────────────────────────────────────────────────┤
│                                                     │
│ ✅ ルール通りのトレード:                            │
│ ├─ 件数: 40件                                      │
│ ├─ 勝率: 62%                                       │
│ ├─ 平均Pips: +15.2                                 │
│ └─ 期待値: +4,200円                                │
│                                                     │
│ ❌ ルール外のトレード:                              │
│ ├─ 件数: 15件                                      │
│ ├─ 勝率: 28%  ← ⚠️ 大きな差！                      │
│ ├─ 平均Pips: -8.5                                  │
│ └─ 期待値: -2,100円                                │
│                                                     │
│ 💡 気づき                                           │
│ ルールを守ったトレードは勝率が2倍以上高いです。     │
│ ルール外のトレードが損失の主な原因です。            │
│                                                     │
└─────────────────────────────────────────────────────┘
```

```
┌─────────────────────────────────────────────────────┐
│ 📊 決済判断の分析                                    │
├─────────────────────────────────────────────────────┤
│                                                     │
│ ■ 利確後のトレンド継続                              │
│ ├─ YES: 35件（70%）                                │
│ │   → 利確が早すぎる傾向あり                       │
│ └─ NO:  15件（30%）                                │
│                                                     │
│ ■ 損切後のトレンド継続                              │
│ ├─ YES: 8件（40%）                                 │
│ │   → 損切り判断は概ね正しい                       │
│ └─ NO:  12件（60%）                                │
│     → 早すぎる損切りの可能性                       │
│                                                     │
└─────────────────────────────────────────────────────┘
```

---

## 機能4: トレード一覧バッジ

### 4.1 目的

```
一覧を見るだけで傾向がわかる
→ 手法バッジ：何の手法か一目瞭然（略称表示）
→ 許容損失バッジ：リスク管理状況が一目瞭然
→ ルール遵守バッジ：規律が一目瞭然
```

### 4.2 バッジデザイン

```
┌─────────────────────────────────────────────────────────────────────────┐
│ トレード一覧                                                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │ 2026/01/15 USD/JPY ロング                                          │ │
│ │ +25.5 pips  +5,100円                                               │ │
│ │ [ダウフィボ] [✅適正] [✅ルール]                                    │ │
│ │  └─ 略称で表示                                                     │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │ 2026/01/14 EUR/USD ショート                                        │ │
│ │ -15.2 pips  -2,280円                                               │ │
│ │ [ブレイク] [⚠️超過] [❌ルール外]                                    │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │ 2026/01/13 GBP/JPY ロング                                          │ │
│ │ +18.0 pips  +3,600円                                               │ │
│ │ [未設定] [✅適正] [✅ルール]                                        │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.3 バッジ種類

| バッジ | 表示内容 | 色 |
|--------|---------|-----|
| 手法バッジ | 略称（shortName）を表示 | グレー背景 |
| 許容損失バッジ | ✅適正 / ⚠️超過 / 🚨大幅超過 | 緑/オレンジ/赤 |
| ルール遵守バッジ | ✅ルール / ❌ルール外 | 緑/赤 |

※ 削除された手法のトレードは、手法バッジを「削除済」とグレー表示

### 4.4 フィルター追加

```
┌─────────────────────────────────────────────────────┐
│ 🔍 フィルター                                        │
├─────────────────────────────────────────────────────┤
│                                                     │
│ 通貨ペア:     [すべて ▼]                            │
│ 方向:         [すべて ▼]                            │
│ 手法:         [すべて ▼]  ← NEW                    │
│ 許容損失:     [すべて ▼]  ← NEW                    │
│               ├─ すべて                            │
│               ├─ 適正のみ                          │
│               └─ 超過のみ                          │
│ ルール遵守:   [すべて ▼]  ← NEW                    │
│               ├─ すべて                            │
│               ├─ ルール通りのみ                    │
│               └─ ルール外のみ                      │
│ 期間:         [今月 ▼]                              │
│                                                     │
└─────────────────────────────────────────────────────┘
```

---

## 機能5: 月次レポート再編成

### 5.1 目的

```
現在のレポート：基本統計のみ
→ 本当に欲しい情報を追加
→ 「これぞレポート」と言えるものに
```

### 5.2 新しい月次レポート構成

```
┌─────────────────────────────────────────────────────┐
│ 📊 月次レポート - 2026年1月                          │
├─────────────────────────────────────────────────────┤
│                                                     │
│ ═══════════════════════════════════════════════════ │
│ 📈 基本成績                                         │
│ ═══════════════════════════════════════════════════ │
│                                                     │
│ トレード数: 25回                                    │
│ 勝敗: 15勝10敗（勝率 60%）                          │
│ 総損益: +45,200円                                   │
│ 総Pips: +156.5 pips                                │
│ PF: 1.85                                           │
│                                                     │
│ ═══════════════════════════════════════════════════ │
│ 🎯 ルール遵守状況 ← NEW                            │
│ ═══════════════════════════════════════════════════ │
│                                                     │
│ ルール通り: 20回（80%）                             │
│ ├─ 勝率: 70%                                       │
│ └─ 損益: +52,000円                                 │
│                                                     │
│ ルール外: 5回（20%）                                │
│ ├─ 勝率: 20%                                       │
│ └─ 損益: -6,800円  ← ここが足を引っ張っている      │
│                                                     │
│ 💡 ルールを守れば、さらに+6,800円の改善余地あり     │
│                                                     │
│ ═══════════════════════════════════════════════════ │
│ 💰 リスク管理状況 ← NEW                            │
│ ═══════════════════════════════════════════════════ │
│                                                     │
│ 許容損失内: 22回（88%）                             │
│ ├─ 勝率: 64%                                       │
│ └─ 損益: +48,500円                                 │
│                                                     │
│ 許容損失超過: 3回（12%）                            │
│ ├─ 勝率: 33%                                       │
│ └─ 損益: -3,300円                                  │
│                                                     │
│ 💡 リスク管理は概ね良好です                         │
│                                                     │
│ ═══════════════════════════════════════════════════ │
│ 📋 手法別成績                                       │
│ ═══════════════════════════════════════════════════ │
│                                                     │
│ 1位: ダウ理論×フィボ押し目（12回）                  │
│     勝率 75% | +32,500円 | PF 2.15                  │
│                                                     │
│ 2位: 水平線ブレイクアウト（8回）                    │
│     勝率 50% | +8,200円 | PF 1.25                   │
│                                                     │
│ 3位: トレンドライン反発（5回）                      │
│     勝率 40% | +4,500円 | PF 1.10                   │
│                                                     │
│ ※ 削除した手法のトレードは集計に含まれません        │
│                                                     │
│ 🔒 Pro版で利用可能                                  │
│ AIによる「気づき」生成                              │
│ （例：「この手法に絞ると成績向上の可能性」など）    │
│                                                     │
│ ═══════════════════════════════════════════════════ │
│ 🔄 決済判断の振り返り ← NEW                        │
│ ═══════════════════════════════════════════════════ │
│                                                     │
│ 利確後トレンド継続: 12回/18回（67%）                │
│ → 利確タイミングを見直す余地あり                   │
│                                                     │
│ 損切後トレンド継続: 3回/7回（43%）                  │
│ → 損切り判断は概ね正しい                           │
│                                                     │
│ ═══════════════════════════════════════════════════ │
│ 📝 今月の総括                                       │
│ ═══════════════════════════════════════════════════ │
│                                                     │
│ ✅ 良かった点                                       │
│ ・ルール遵守率80%達成                               │
│ ・ダウ×フィボ手法が安定                            │
│                                                     │
│ ⚠️ 改善点                                          │
│ ・ルール外トレード5回で-6,800円の損失               │
│ ・利確が早すぎる傾向                                │
│                                                     │
│ 🎯 来月の目標                                       │
│ ・ルール遵守率90%以上                               │
│ ・ダウ×フィボ手法に集中                            │
│                                                     │
└─────────────────────────────────────────────────────┘
```

---

## UI設計

### 設定タブ トレーディングサブタブの構成

```
┌─────────────────────────────────────────────────────┐
│ ⚙️ 設定                                             │
├─────────────────────────────────────────────────────┤
│ [基本] [トレーディング●] [データ]                    │
├─────────────────────────────────────────────────────┤
│                                                     │
│ 🏢 ブローカー管理                    ← 既存        │
│ ─────────────────────────────────────              │
│ ...                                                │
│                                                     │
│ ⭐ お気に入り通貨ペア                 ← 既存        │
│ ─────────────────────────────────────              │
│ ...                                                │
│                                                     │
│ 💰 許容損失管理                       ← NEW        │
│ ─────────────────────────────────────              │
│ ...                                                │
│                                                     │
│ 📋 手法管理                           ← NEW        │
│ ─────────────────────────────────────              │
│ ...                                                │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 新規エントリー画面の追加項目

```
┌─────────────────────────────────────────────────────┐
│ 📊 リスク管理                         ← NEW        │
├─────────────────────────────────────────────────────┤
│ 許容損失: 5,000円                                   │
│ 損切り幅: [  ] pips                                │
│ 決済通貨レート: [  ] 円                            │
│ 適正ロット: 自動計算                               │
└─────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────┐
│ 📋 手法選択                           ← NEW        │
├─────────────────────────────────────────────────────┤
│ [▼ 手法を選択                              ]       │
└─────────────────────────────────────────────────────┘
```

### 決済画面の追加項目

```
┌─────────────────────────────────────────────────────┐
│ 📝 振り返り                           ← NEW        │
├─────────────────────────────────────────────────────┤
│ ルール通り？  [YES] [NO]                           │
│ トレンド継続？ [YES] [NO] [未確認]                 │
└─────────────────────────────────────────────────────┘
```

---

## モジュール設計（MODULES.md準拠）

### ファイル配置

```
js/
├── part5_modules/
│   └── SettingsModule.js      ← API追加（許容損失・手法管理）
├── part5/
│   ├── broker-ui.js           ← 既存
│   ├── favorite-pair-ui.js    ← 既存
│   ├── risk-ui.js             ← 新規（許容損失UI）
│   └── method-ui.js           ← 新規（手法管理UI）
├── modules/
│   └── AISummaryModule.js     ← 新規（AIサマリー生成）
├── part2_modules/
│   ├── TradeEntry.js          ← 修正（リスク管理・手法選択追加）
│   └── TradeExit.js           ← 修正（振り返り追加）
└── part8_modules/
    ├── StatisticsModule.js    ← 修正（新統計項目追加）
    └── ReportModule.js        ← 修正（レポート再編成）
```

### SettingsModule API拡張

```javascript
// 既存API（変更なし）
getPresetBrokers()
getAllBrokers()
getBrokerById(id)
addBroker(broker)
updateBroker(id, broker)
deleteBroker(id)
getFavoritePairs()
addFavoritePair(pair)
removeFavoritePair(pair)
getPresetCurrencyPairs()
searchCurrencyPairs(query)
getSiteName()
setSiteName(name)
getSubtitle()
setSubtitle(subtitle)

// ═══════════════════════════════════════════════════
// NEW: 許容損失管理
// ═══════════════════════════════════════════════════
getRiskTolerance()              // 許容損失取得（円）
setRiskTolerance(amount)        // 許容損失設定（円）
// → emit: 'settings:riskToleranceUpdated'

// ═══════════════════════════════════════════════════
// NEW: 手法管理
// ═══════════════════════════════════════════════════
getAllMethods()                 // 全手法取得（deletedAt=null のみ）
getMethodById(id)               // ID指定で取得
addMethod(name, shortName, memo) // 手法追加
// → emit: 'settings:methodAdded'
deleteMethod(id)                // 手法削除（論理削除: deletedAtに日時設定）
// → emit: 'settings:methodDeleted'

getStatus()                     // デバッグ用（既存）
```

### SettingsModule 実装例

```javascript
// js/part5_modules/SettingsModule.js に追加

class SettingsModule {
    // ... 既存のプライベートフィールド ...
    #riskTolerance = null;
    #methods = [];
    
    // ... 既存のconstructor ...
    
    // ═══════════════════════════════════════════════════
    // 許容損失管理
    // ═══════════════════════════════════════════════════
    
    /**
     * 許容損失を取得
     * @returns {number|null} 許容損失額（円）、未設定ならnull
     */
    getRiskTolerance() {
        if (this.#riskTolerance === null) {
            const saved = localStorage.getItem('tc_risk_tolerance');
            this.#riskTolerance = saved ? parseInt(saved, 10) : null;
        }
        return this.#riskTolerance;
    }
    
    /**
     * 許容損失を設定
     * @param {number} amount - 許容損失額（円）
     */
    setRiskTolerance(amount) {
        if (typeof amount !== 'number' || amount < 0) {
            console.error('🔧 SettingsModule: 無効な許容損失額');
            return false;
        }
        this.#riskTolerance = amount;
        localStorage.setItem('tc_risk_tolerance', amount.toString());
        this.#eventBus?.emit('settings:riskToleranceUpdated', { amount });
        console.log('🔧 SettingsModule: 許容損失を更新', amount);
        return true;
    }
    
    // ═══════════════════════════════════════════════════
    // 手法管理
    // ═══════════════════════════════════════════════════
    
    /**
     * 全手法を取得（削除済み除く）
     * @returns {Array} 手法配列
     */
    getAllMethods() {
        this.#loadMethods();
        return this.#methods.filter(m => m.deletedAt === null);
    }
    
    /**
     * IDで手法を取得
     * @param {string} id - 手法ID
     * @returns {Object|null} 手法オブジェクト
     */
    getMethodById(id) {
        this.#loadMethods();
        return this.#methods.find(m => m.id === id) || null;
    }
    
    /**
     * 手法を追加
     * @param {string} name - 正式名（最大30文字）
     * @param {string} shortName - 略称（最大10文字）
     * @param {string} memo - メモ（最大200文字、任意）
     * @returns {Object|null} 追加された手法、失敗時null
     */
    addMethod(name, shortName, memo = '') {
        // バリデーション
        if (!name || name.length > 30) {
            console.error('🔧 SettingsModule: 手法名が無効');
            return null;
        }
        if (!shortName || shortName.length > 10) {
            console.error('🔧 SettingsModule: 略称が無効');
            return null;
        }
        if (memo.length > 200) {
            console.error('🔧 SettingsModule: メモが長すぎます');
            return null;
        }
        
        // 上限チェック
        const activeMethods = this.getAllMethods();
        if (activeMethods.length >= 10) {
            console.error('🔧 SettingsModule: 手法は最大10個まで');
            return null;
        }
        
        this.#loadMethods();
        
        const method = {
            id: 'mtd_' + Date.now(),
            name: name.trim(),
            shortName: shortName.trim(),
            memo: memo.trim(),
            order: this.#methods.length + 1,
            createdAt: new Date().toISOString(),
            deletedAt: null
        };
        
        this.#methods.push(method);
        this.#saveMethods();
        this.#eventBus?.emit('settings:methodAdded', { method });
        console.log('🔧 SettingsModule: 手法を追加', method.name);
        return method;
    }
    
    /**
     * 手法を削除（論理削除）
     * @param {string} id - 手法ID
     * @returns {boolean} 成功/失敗
     */
    deleteMethod(id) {
        this.#loadMethods();
        const method = this.#methods.find(m => m.id === id);
        if (!method) {
            console.error('🔧 SettingsModule: 手法が見つかりません', id);
            return false;
        }
        
        method.deletedAt = new Date().toISOString();
        this.#saveMethods();
        this.#eventBus?.emit('settings:methodDeleted', { methodId: id });
        console.log('🔧 SettingsModule: 手法を削除', method.name);
        return true;
    }
    
    // Private
    #loadMethods() {
        if (this.#methods.length === 0) {
            const saved = localStorage.getItem('tc_methods');
            this.#methods = saved ? JSON.parse(saved) : [];
        }
    }
    
    #saveMethods() {
        localStorage.setItem('tc_methods', JSON.stringify(this.#methods));
    }
    
    // getStatus() に追加
    getStatus() {
        return {
            // ... 既存の項目 ...
            riskTolerance: this.getRiskTolerance(),
            methodCount: this.getAllMethods().length,
            totalMethods: this.#methods.length  // 削除済み含む
        };
    }
}
```

### EventBus イベント一覧

```javascript
// 許容損失
'settings:riskToleranceUpdated'  // { amount: number }

// 手法管理
'settings:methodAdded'           // { method: Object }
'settings:methodDeleted'         // { methodId: string }

// AIサマリー（将来）
'aiSummary:generated'            // { yearMonth: string }
```

### AISummaryModule（Phase 6）

```javascript
// js/modules/AISummaryModule.js

class AISummaryModule {
    #eventBus = null;
    
    constructor() {
        this.#eventBus = window.eventBus;
    }
    
    // ═══════════════════════════════════════════════════
    // Public API
    // ═══════════════════════════════════════════════════
    
    /**
     * 月次サマリーを生成
     * @param {string} yearMonth - 対象月（YYYY-MM）
     * @returns {Object} 生成されたサマリー
     */
    generate(yearMonth) {
        const trades = this.#getTradesForMonth(yearMonth);
        
        const summary = {
            period: yearMonth,
            generatedAt: new Date().toISOString(),
            version: '1.0',
            basic: this.#calculateBasicStats(trades),
            ruleCompliance: this.#calculateRuleCompliance(trades),
            riskManagement: this.#calculateRiskManagement(trades),
            methodStats: this.#calculateMethodStats(trades),
            reflection: this.#calculateReflection(trades),
            pairStats: this.#calculatePairStats(trades),
            timeAnalysis: this.#calculateTimeAnalysis(trades)
        };
        
        // 保存
        localStorage.setItem(`tc_ai_summary_${yearMonth}`, JSON.stringify(summary));
        this.#eventBus?.emit('aiSummary:generated', { yearMonth });
        
        return summary;
    }
    
    /**
     * 保存済みサマリーを取得
     * @param {string} yearMonth - 対象月（YYYY-MM）
     * @returns {Object|null} サマリー、未生成ならnull
     */
    get(yearMonth) {
        const saved = localStorage.getItem(`tc_ai_summary_${yearMonth}`);
        return saved ? JSON.parse(saved) : null;
    }
    
    /**
     * デバッグ用ステータス
     */
    getStatus() {
        const keys = Object.keys(localStorage).filter(k => k.startsWith('tc_ai_summary_'));
        return {
            savedSummaries: keys.length,
            months: keys.map(k => k.replace('tc_ai_summary_', ''))
        };
    }
    
    // ═══════════════════════════════════════════════════
    // Private Methods
    // ═══════════════════════════════════════════════════
    
    #getTradesForMonth(yearMonth) {
        const tm = window.TradeManager?.getInstance();
        if (!tm) return [];
        return tm.getAllTrades().filter(t => {
            const tradeMonth = t.entryDate?.substring(0, 7);
            return tradeMonth === yearMonth && t.exitDate;  // 決済済みのみ
        });
    }
    
    #calculateBasicStats(trades) { /* 実装 */ }
    #calculateRuleCompliance(trades) { /* 実装 */ }
    #calculateRiskManagement(trades) { /* 実装 */ }
    #calculateMethodStats(trades) { /* 実装 */ }
    #calculateReflection(trades) { /* 実装 */ }
    #calculatePairStats(trades) { /* 実装 */ }
    #calculateTimeAnalysis(trades) { /* 実装 */ }
}

window.AISummaryModule = new AISummaryModule();
```

---

## データ構造

### localStorage キー

| キー | 内容 |
|------|------|
| `tc_risk_tolerance` | 許容損失金額（数値） |
| `tc_methods` | 手法配列 |
| `tc_ai_summary_{YYYY-MM}` | AI参照用月次サマリー（将来用） |

### 手法データ

```javascript
// tc_methods
[
  { 
    id: 'mtd_001', 
    name: 'ダウ理論×フィボ押し目買い',   // 正式名（最大30文字）
    shortName: 'ダウフィボ',              // 略称（最大10文字、バッジ表示用）
    memo: '日足トレンド確認→4H押し目',   // メモ（最大200文字）
    order: 1,
    createdAt: '2026-01-16T10:00:00Z',
    deletedAt: null                       // 削除日時（nullなら有効）
  },
  // ...
]

// 削除時の処理
// 物理削除ではなく、deletedAtに日時を設定（論理削除）
// → 分析時にdeletedAtがnullのものだけ集計
// → プルダウンにはdeletedAtがnullのものだけ表示
```

### トレードデータへの追加フィールド

```javascript
// 既存のtradeオブジェクトに追加
{
  // ...既存フィールド...
  
  // NEW: リスク管理
  riskTolerance: 5000,           // その時の許容損失設定
  stopLossPips: 20,              // 損切り幅（pips）
  quoteCurrencyRate: 150,        // 決済通貨レート（円）
  calculatedLot: 2.5,            // 計算された適正ロット
  isOverRisk: false,             // 許容損失超過フラグ
  riskStatus: 'normal',          // 'normal' | 'warning' | 'danger'
  
  // NEW: 手法
  methodId: 'mtd_001',           // 使用手法ID
  
  // NEW: 振り返り
  followedRules: true,           // ルール遵守フラグ
  trendContinued: 'unknown',     // 決済後トレンド継続（yes/no/unknown）
}
```

---

## AI参照設計（将来のPro版用）

### 設計思想

```
【問題】
後から「データ構造変えたい」→「既存データが使えない」

【解決策】
AIが参照するサマリー構造を今決めておく
→ 実装時にここを見るだけでOK
→ データ不整合が起きない
```

### データフロー

```
【現在の実装（Free版）】
トレードデータ → 分析モジュール → 画面表示

【将来のAI実装（Pro版）】
トレードデータ → 分析モジュール → 📦 AIサマリー → AI API → 気づき生成
                                    ↑
                              ここを今設計する
```

### AI参照用サマリー構造

```javascript
// localStorage キー: tc_ai_summary_{YYYY-MM}
// 例: tc_ai_summary_2026-01

{
  // メタ情報
  period: '2026-01',                    // 対象期間
  generatedAt: '2026-01-31T23:59:59Z',  // 生成日時
  version: '1.0',                       // サマリー構造バージョン
  
  // ═══════════════════════════════════════════════════
  // 基本成績
  // ═══════════════════════════════════════════════════
  basic: {
    totalTrades: 25,          // 総トレード数
    wins: 15,                 // 勝ち数
    losses: 10,               // 負け数
    winRate: 60.0,            // 勝率（%）
    totalPips: 156.5,         // 総獲得Pips
    totalProfitYen: 45200,    // 総損益（円）
    profitFactor: 1.85,       // プロフィットファクター
    averageWinPips: 18.5,     // 平均勝ちPips
    averageLossPips: -12.3,   // 平均負けPips
    averageRR: 1.50,          // 平均リスクリワード
    maxConsecutiveWins: 5,    // 最大連勝
    maxConsecutiveLosses: 3,  // 最大連敗
    maxDrawdownYen: -15000    // 最大ドローダウン（円）
  },
  
  // ═══════════════════════════════════════════════════
  // ルール遵守分析（★AI最重視）
  // ═══════════════════════════════════════════════════
  ruleCompliance: {
    // ルール通りのトレード
    followed: {
      count: 20,              // 件数
      rate: 80.0,             // 全体に占める割合（%）
      wins: 14,               // 勝ち数
      losses: 6,              // 負け数
      winRate: 70.0,          // 勝率（%）
      totalPips: 165.2,       // 総Pips
      totalProfitYen: 52000,  // 総損益（円）
      profitFactor: 2.10      // PF
    },
    // ルール外のトレード
    notFollowed: {
      count: 5,
      rate: 20.0,
      wins: 1,
      losses: 4,
      winRate: 20.0,
      totalPips: -8.7,
      totalProfitYen: -6800,
      profitFactor: 0.45
    },
    // 差分（AIが気づきを出しやすい）
    winRateDiff: 50.0,        // 勝率差（followed - notFollowed）
    profitDiff: 58800         // 損益差
  },
  
  // ═══════════════════════════════════════════════════
  // リスク管理分析（★AI重視）
  // ═══════════════════════════════════════════════════
  riskManagement: {
    // 許容損失内のトレード
    withinTolerance: {
      count: 22,
      rate: 88.0,
      winRate: 64.0,
      totalProfitYen: 48500,
      profitFactor: 1.95
    },
    // 許容損失超過のトレード（注意レベル）
    warningLevel: {
      count: 2,
      rate: 8.0,
      winRate: 50.0,
      totalProfitYen: -1000,
      profitFactor: 0.80
    },
    // 許容損失大幅超過のトレード（危険レベル）
    dangerLevel: {
      count: 1,
      rate: 4.0,
      winRate: 0.0,
      totalProfitYen: -2300,
      profitFactor: 0.00
    },
    // 差分
    winRateDiff: 31.0         // 適正 vs 超過の勝率差
  },
  
  // ═══════════════════════════════════════════════════
  // 手法別分析（★AI重視）
  // ═══════════════════════════════════════════════════
  methodStats: [
    {
      methodId: 'mtd_001',
      methodName: 'ダウ理論×フィボ押し目買い',
      shortName: 'ダウフィボ',
      count: 12,
      winRate: 75.0,
      totalPips: 95.3,
      totalProfitYen: 32500,
      profitFactor: 2.15,
      averageRR: 1.85,
      rank: 1                 // 成績順位
    },
    {
      methodId: 'mtd_002',
      methodName: '水平線ブレイクアウト',
      shortName: 'ブレイク',
      count: 8,
      winRate: 50.0,
      totalPips: 35.2,
      totalProfitYen: 8200,
      profitFactor: 1.25,
      averageRR: 1.20,
      rank: 2
    },
    // ...
  ],
  // 未設定手法のトレード
  noMethodTrades: {
    count: 5,
    winRate: 40.0,
    totalProfitYen: -500
  },
  
  // ═══════════════════════════════════════════════════
  // 決済判断の振り返り
  // ═══════════════════════════════════════════════════
  reflection: {
    // 利確後のトレンド継続
    afterTakeProfit: {
      trendContinued: 12,     // YES
      trendEnded: 6,          // NO
      unknown: 0,             // 未確認
      continuedRate: 66.7     // 継続率（%）→ 高いと利確が早い
    },
    // 損切後のトレンド継続
    afterStopLoss: {
      trendContinued: 3,      // YES（損切り正解）
      trendEnded: 4,          // NO（損切り早すぎた可能性）
      unknown: 0,
      continuedRate: 42.9     // 継続率（%）
    }
  },
  
  // ═══════════════════════════════════════════════════
  // 通貨ペア別分析（参考情報）
  // ═══════════════════════════════════════════════════
  pairStats: [
    {
      pair: 'USD/JPY',
      count: 10,
      winRate: 70.0,
      totalPips: 85.2,
      totalProfitYen: 25500,
      rank: 1
    },
    {
      pair: 'EUR/USD',
      count: 8,
      winRate: 50.0,
      totalPips: 42.3,
      totalProfitYen: 12600,
      rank: 2
    },
    // ...
  ],
  
  // ═══════════════════════════════════════════════════
  // 曜日・時間帯分析（参考情報）
  // ═══════════════════════════════════════════════════
  timeAnalysis: {
    byDayOfWeek: [
      { day: 'Mon', count: 5, winRate: 60.0 },
      { day: 'Tue', count: 6, winRate: 66.7 },
      { day: 'Wed', count: 4, winRate: 50.0 },
      { day: 'Thu', count: 5, winRate: 80.0 },
      { day: 'Fri', count: 5, winRate: 40.0 }
    ],
    bestDay: 'Thu',           // 最も勝率が高い曜日
    worstDay: 'Fri'           // 最も勝率が低い曜日
  }
}
```

### AIへの渡し方（Pro版実装時）

```javascript
// 将来のPro版AI機能実装例
async function generateAIInsights(yearMonth) {
  // サマリーを取得
  const summaryKey = `tc_ai_summary_${yearMonth}`;
  const summary = JSON.parse(localStorage.getItem(summaryKey));
  
  if (!summary) {
    return { error: 'サマリーがありません' };
  }
  
  // AIに渡すプロンプト
  const prompt = `
あなたはFXトレードの専門アナリストです。
以下はユーザーの${yearMonth}のトレード分析サマリーです。

このデータを元に：
1. 最も改善インパクトが大きいポイント（1つ）
2. 具体的な改善アクション（3つ以内）
3. 継続すべき良い習慣（1つ）

を簡潔に提供してください。

【分析データ】
${JSON.stringify(summary, null, 2)}
`;
  
  // AI API呼び出し（Claude API等）
  const response = await callAIAPI(prompt);
  
  return response;
}
```

### サマリー生成タイミング

| タイミング | トリガー |
|-----------|---------|
| 月次自動生成 | 月末 or 翌月1日の初回アクセス時 |
| 手動生成 | レポート表示時に「最新化」ボタン |
| 締め処理時 | 月次締め実行時に自動生成 |

### バージョン管理

```javascript
// サマリー構造を変更する場合
{
  version: '1.0',  // → '1.1' に変更
  // ...
}

// 古いバージョンのサマリーは、必要に応じてマイグレーション
// または、再生成を促す
```

### 設計のポイント

| ポイント | 理由 |
|----------|------|
| 集計済みデータ | AIに生データを渡すとトークン消費大 |
| 差分を事前計算 | AIが気づきを出しやすい |
| ランク付け | 「1位の手法は〜」と言いやすい |
| 率（%）を含める | 件数だけだと判断しづらい |

---

## 実装ロードマップ

### 全体進捗

| Phase | 内容 | 状態 | 完了日 |
|-------|------|------|--------|
| Phase 1 | 設定機能 | ⬜ 未着手 | - |
| Phase 2 | エントリー画面 | ⬜ 未着手 | - |
| Phase 3 | 決済・振り返り | ⬜ 未着手 | - |
| Phase 4 | 一覧・分析 | ⬜ 未着手 | - |
| Phase 5 | 月次レポート | ⬜ 未着手 | - |
| Phase 6 | AI参照用サマリー基盤 | ⬜ 未着手 | - |

**進捗率**: 0% (0/37タスク)

---

### Phase 1: 設定機能（10タスク）

#### 1-1. 許容損失管理（SettingsModule拡張）

| # | タスク | ファイル | 状態 |
|---|--------|----------|------|
| 1 | ⬜ getRiskTolerance() API追加 | js/part5_modules/SettingsModule.js | 未着手 |
| 2 | ⬜ setRiskTolerance(amount) API追加 | js/part5_modules/SettingsModule.js | 未着手 |
| 3 | ⬜ EventBus 'settings:riskToleranceUpdated' 追加 | js/part5_modules/SettingsModule.js | 未着手 |
| 4 | ⬜ 許容損失UI HTML追加 | index.html | 未着手 |
| 5 | ⬜ 許容損失UI JavaScript追加 | js/part5/risk-ui.js（新規） | 未着手 |

#### 1-2. 手法管理（SettingsModule拡張）

| # | タスク | ファイル | 状態 |
|---|--------|----------|------|
| 6 | ⬜ getAllMethods() API追加 | js/part5_modules/SettingsModule.js | 未着手 |
| 7 | ⬜ addMethod(name, shortName, memo) API追加 | js/part5_modules/SettingsModule.js | 未着手 |
| 8 | ⬜ deleteMethod(id) API追加（論理削除） | js/part5_modules/SettingsModule.js | 未着手 |
| 9 | ⬜ 手法管理UI HTML追加 | index.html | 未着手 |
| 10 | ⬜ 手法管理UI JavaScript追加 | js/part5/method-ui.js（新規） | 未着手 |

**Phase 1 進捗**: 0/10

---

### Phase 2: エントリー画面（8タスク）

#### 2-1. リスク管理セクション

| # | タスク | ファイル | 状態 |
|---|--------|----------|------|
| 11 | ⬜ リスク管理セクションHTML追加 | index.html | 未着手 |
| 12 | ⬜ 損切り幅(pips)入力欄追加 | TradeEntry.js | 未着手 |
| 13 | ⬜ 決済通貨レート入力欄追加 | TradeEntry.js | 未着手 |
| 14 | ⬜ 適正ロット自動計算ロジック | TradeEntry.js | 未着手 |
| 15 | ⬜ 警告色表示（白/オレンジ/赤） | TradeEntry.js, CSS | 未着手 |
| 16 | ⬜ トレード保存時にリスク情報追加 | TradeEntry.js | 未着手 |

#### 2-2. 手法選択

| # | タスク | ファイル | 状態 |
|---|--------|----------|------|
| 17 | ⬜ 手法選択プルダウンHTML追加 | index.html | 未着手 |
| 18 | ⬜ 手法選択ロジック・保存 | TradeEntry.js | 未着手 |

**Phase 2 進捗**: 0/8

---

### Phase 3: 決済・振り返り（4タスク）

| # | タスク | ファイル | 状態 |
|---|--------|----------|------|
| 19 | ⬜ 振り返りセクションHTML追加 | index.html | 未着手 |
| 20 | ⬜ ルール遵守フラグ(YES/NO)追加 | TradeExit.js | 未着手 |
| 21 | ⬜ トレンド継続フラグ追加 | TradeExit.js | 未着手 |
| 22 | ⬜ 振り返りデータ保存 | TradeExit.js | 未着手 |

**Phase 3 進捗**: 0/4

---

### Phase 4: 一覧・分析（6タスク）

#### 4-1. トレード一覧バッジ

| # | タスク | ファイル | 状態 |
|---|--------|----------|------|
| 23 | ⬜ 手法バッジ表示（略称） | TradeList.js | 未着手 |
| 24 | ⬜ 許容損失バッジ表示 | TradeList.js | 未着手 |
| 25 | ⬜ ルール遵守バッジ表示 | TradeList.js | 未着手 |
| 26 | ⬜ バッジ用CSS追加 | 4_features.css | 未着手 |

#### 4-2. フィルター・統計

| # | タスク | ファイル | 状態 |
|---|--------|----------|------|
| 27 | ⬜ 手法フィルター追加 | TradeList.js | 未着手 |
| 28 | ⬜ 統計計算に新項目追加 | StatisticsModule.js | 未着手 |

**Phase 4 進捗**: 0/6

---

### Phase 5: 月次レポート再編成（4タスク）

| # | タスク | ファイル | 状態 |
|---|--------|----------|------|
| 29 | ⬜ ルール遵守セクション追加 | ReportModule.js | 未着手 |
| 30 | ⬜ リスク管理セクション追加 | ReportModule.js | 未着手 |
| 31 | ⬜ 手法別成績セクション追加 | ReportModule.js | 未着手 |
| 32 | ⬜ 決済判断振り返りセクション追加 | ReportModule.js | 未着手 |

**Phase 5 進捗**: 0/4

---

### Phase 6: AI参照用サマリー基盤（5タスク）

| # | タスク | ファイル | 状態 |
|---|--------|----------|------|
| 33 | ⬜ AISummaryModule クラス作成 | js/modules/AISummaryModule.js（新規） | 未着手 |
| 34 | ⬜ #calculateBasicStats() 実装 | js/modules/AISummaryModule.js | 未着手 |
| 35 | ⬜ #calculateRuleCompliance() 実装 | js/modules/AISummaryModule.js | 未着手 |
| 36 | ⬜ #calculateRiskManagement() 実装 | js/modules/AISummaryModule.js | 未着手 |
| 37 | ⬜ #calculateMethodStats() 実装 | js/modules/AISummaryModule.js | 未着手 |

**Phase 6 進捗**: 0/5

※ Phase 6はPro版AI機能の**土台**。Free版リリース時点で構造を確定させ、データ蓄積を開始。

---

### 完了チェックリスト（実装後に確認）

| # | 確認項目 | 状態 |
|---|----------|------|
| - | ⬜ 全機能の動作確認 | - |
| - | ⬜ 既存データとの互換性確認 | - |
| - | ⬜ モバイル表示確認 | - |
| - | ⬜ MODULES.md更新 | - |
| - | ⬜ TASKS.md更新 | - |

---

## 更新履歴

| バージョン | 日付 | 内容 |
|-----------|------|------|
| v1.0 | 2026-01-16 | 初版作成 |
| v1.1 | 2026-01-16 | 感情管理削除、為替レート入力追加、バッジ追加、レポート再編成追加 |
| v1.2 | 2026-01-16 | 警告閾値を2倍に変更、設計思想・AI布石を追記 |
| v1.3 | 2026-01-16 | 手法管理：編集不可・略称追加・削除時の挙動明確化、気づきはPro版AI機能へ、ロードマップ形式に変更 |
| v1.4 | 2026-01-16 | AI参照設計セクション追加、Phase 6（AIサマリー基盤）追加、37タスクに拡張 |
| v1.5 | 2026-01-16 | MODULES.md準拠に修正：ファイル配置・SettingsModule API・EventBus命名・実装例追加 |

---

*このドキュメントは開発時の指針です。最新の技術仕様はMODULES.mdを参照してください。*
