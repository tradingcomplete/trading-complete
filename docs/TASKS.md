# TASKS.md - Trading Complete タスク管理
*更新日: 2026-02-01 | 次回レビュー: リリース時*

---

## 🚀 リリースロードマップ（最優先）

**目標**: tradingcomplete.comを本番リリース

### 📅 進捗状況

| Week | タスク | 状態 |
|------|--------|------|
| 1-5 | モジュール化・UI改善 | ✅完了 |
| 6 | 基本レスポンシブ対応 | ✅完了 |
| 7 | クラウド化準備 | ✅完了 |
| 8 | 本番リリース準備 | □ 予定 |

---

### ✅ Week 6: 基本レスポンシブ対応（完了）

**完了日**: 2025-12-12 | **工数**: 約10h

- ✅ ヘッダー・タブナビ（ロゴ縮小、タブ2×3グリッド）
- ✅ 新規エントリーフォーム（1カラム化、画像横スクロール）
- ✅ トレード記録（カードフル幅、フィルター縮小）
- ✅ 相場ノート（週間プレビューアコーディオン）
- ✅ 分析タブ（統計グリッド3列→2列、チャート調整）
- ✅ 収支管理タブ（サマリー、経費一覧、入出金管理）
- ✅ 設定タブ（セルフイメージ横並び、エクスポート/インポート）
- ✅ モーダル（幅95%、余白調整）
- ✅ ライトモード+スマホ対応

**ブレークポイント**: 1024px / 768px / 480px / 360px / 横向き

---

### ✅ Week 7: クラウド化準備（完了）

**完了日**: 2025-12-17

#### ✅ 完了タスク
- ✅ GitHub Pages デプロイ
- ✅ GitHub連携（自動デプロイ）
- ✅ ライトモード調整
- ✅ Google Analytics設定

**公開URL**: 
- ホームページ: https://tradingcomplete.com
- アプリ: https://tradingcomplete.com/trading-complete/（リリース前・限定公開）

**備考**: Netlifyはデプロイ制限により、GitHub Pagesへ移行

---

### ✅ Supabase Phase 4: データ同期実装（完了）

**完了日**: 2026-01-14

| Step | 内容 | 完了日 |
|------|------|--------|
| 4.1-4.3 | SyncModule + 全5テーブル同期 | 2026-01-04 |
| 4.4 | マイページ変更機能 | 2026-01-14 |
| 4.5 | Supabase Storage（画像保存） | 2026-01-05 |
| 4.6 | スマホ相場ノート詳細パネル | 2026-01-09 |
| 4.7 | セルフイメージ・アイコン同期 | 2026-01-09 |
| 4.8 | セキュリティ適用（XSS対策） | 2026-01-14 |
| 4.9 | 初回移行フロー | スキップ |

**実装成果**:
- SyncModule v1.6.0（全データ同期 + セキュリティ）
- AuthModule v1.3.0（マイページ変更機能）
- 全入力フィールドにXSS対策サニタイズ適用
- 画像はSupabase Storageに保存

**詳細**: Supabase導入_ロードマップ_v2_1.md

---

### 🎯 Week 8: 本番リリース準備

- ✅ デプロイ完了（GitHub Pages）
- ✅ 独自ドメイン接続
- ✅ Supabase Phase 4 完了
- ✅ 最終テスト（Phase 5.1-5.4完了）
- ✅ トレード分析強化機能（全Phase完了 2026-02-01）
- □ 正式リリース発表

**所要時間**: 1週間（分析強化機能含む）

---

## ☁️ Supabase導入進捗

**詳細**: Supabase導入_ロードマップ_v1_9.md

| Phase | 内容 | 状態 |
|-------|------|------|
| 1 | 準備・環境構築 | ✅ 完了 |
| 2 | データベース設計 | ✅ 完了 |
| 3 | 認証実装 | ✅ 完了 |
| 3.5 | マイページUI | ✅ 完了 |
| 3.6 | セキュリティ基盤 | ✅ 完了 |
| 4.1-4.3 | データ同期（5テーブル） | ✅ 完了 |
| 4.5 | Supabase Storage（画像保存） | ✅ 完了 |
| 4.6 | スマホ相場ノート詳細パネル | ✅ 完了 |
| 4.7 | セルフイメージ・アイコン同期 | ✅ 完了 |
| 4.8 | セキュリティ適用 | ✅ 完了 |
| **5** | **統合テスト・本番準備** | **✅ テスト完了** |

### 完了タスク一覧

| タスク | 状態 | 完了日 |
|--------|------|--------|
| Phase 4.5 Supabase Storage | ✅ | 2026-01-05 |
| ログイン時クラウド同期（AuthModule v1.2.0） | ✅ | 2026-01-05 |
| ノートUI自動更新（sync:notes:synced対応） | ✅ | 2026-01-05 |
| 署名付きURL期限自動更新（imageUtils v1.1.0） | ✅ | 2026-01-14 |
| NoteManagerModule画像自動更新対応 | ✅ | 2026-01-14 |
| Phase 4.6 スマホ相場ノート詳細パネル | ✅ | 2026-01-14 |
| Phase 4.7 セルフイメージ・アイコン同期 | ✅ | 2026-01-14 |
| Phase 4.8 セキュリティ適用 | ✅ | 2026-01-14 |
| **Phase 5.1 機能テスト** | ✅ | **2026-01-15** |
| **Phase 5.2 セキュリティテスト** | ✅ | **2026-01-15** |
| **Phase 5.3 エッジケーステスト** | ✅ | **2026-01-15** |
| **Phase 5.4 本番環境準備確認** | ✅ | **2026-01-15** |
| **画像説明欄追加機能（Phase 1-8完了）** | ✅ | **2026-01-23** |
| **imageUtils.js v1.3.0（v1.1.0+v1.2.0統合）** | ✅ | **2026-01-22** |
| **画像コメント改行・横幅問題修正** | ✅ | **2026-01-25** |

### Phase 4.6-4.7 完了内容（2026-01-14）

- **署名付きURL期限自動更新**: imageUtils v1.1.0で7日期限の自動更新実装
- **NoteManagerModule画像自動更新対応**: EventBus監視で画像表示を自動更新
- **Phase 4.6**: スマホ相場ノート詳細パネルのレスポンシブ対応
- **Phase 4.7**: セルフイメージ・アイコンのSupabase Storage同期

### Phase 5 テスト完了内容（2026-01-15）

| テスト | 項目数 | 結果 |
|--------|--------|------|
| 5.1 機能テスト | 12/13 | ✅ 合格 |
| 5.2 セキュリティテスト | 3/3 | ✅ 合格 |
| 5.3 エッジケーステスト | 3/3 | ✅ 合格（1件制限あり） |
| 5.4 本番環境準備確認 | 6/6 | ✅ 合格 |

**既知の制限**:
- オフライン保存→リロードでクラウドに上書き（v1.1対応予定）
- iOS Safari goalsボタン問題（調査中）

### 画像説明欄追加機能 完了（2026-01-25）

- **題名・説明の追加機能**: 画像に最大30文字の題名、100文字の説明を追加可能
- **全画面での題名表示**: 画像の題名を全画面で表示
- **拡大モーダルでの編集機能**: モーダル内で題名・説明を編集可能（✏️鉛筆マーク）
- **Supabase同期対応**: 画像メタデータをクラウドに同期
- **URL期限切れ自動更新対応**: pathフィールドから署名付きURLを自動再生成
- **imageUtils.js v1.3.0**: v1.1.0（URL期限切れ処理）+ v1.2.0（説明欄）を統合
- **Phase 8: 画像モーダル統合・デザイン統一**: Step2削除、imageCaptionEditModal統合、鉛筆マーク常時表示
- **画像コメント改行・横幅問題解決（01/25）**: スマホ表示時のキャプション幅を`vw`単位で修正（129px→387px）

**詳細**: 画像説明欄追加_要件定義書_v2_1.md

**次のアクション**: 正式リリース発表

---

## ✅ トレード分析強化（全Phase完了）

**目的**: 「記録するだけ」→「成長できるシステム」への進化  
**完了日**: 2026-02-01  
**詳細**: トレード分析強化_要件定義書_ロードマップ_v1_16_最終版.md

### 実装した6機能

| 機能 | 目的 | 効果 | 状態 |
|------|------|------|------|
| 許容損失管理 | リスク管理の習慣化 | 資金を守る | ✅ |
| 手法管理 | 手法別の成績分析 | 得意・不得意の把握 | ✅ |
| 振り返り強化 | ルール遵守の可視化 | 規律あるトレード | ✅ |
| バッジ表示 | 一覧での即時把握 | 傾向の気づき | ✅ |
| 分析タブ拡張 | ルール/リスク/手法別分析 | **成長の実感** | ✅ |
| AIサマリー基盤 | 将来のAI機能準備 | v2.0への布石 | ✅ |

### 実装ロードマップ（完了）

| Phase | 内容 | タスク数 | 完了日 |
|-------|------|---------|--------|
| 1 | 設定機能（許容損失・手法） | 10 | 2026-01-29 |
| 2 | エントリー画面（リスク管理・手法選択） | 8 | 2026-01-29 |
| 3 | 決済・振り返り | 4 | 2026-01-29 |
| 4 | 一覧・分析（バッジ・フィルター） | 6 | 2026-01-30 |
| 5 | 分析タブ拡張 | 3 | 2026-01-30 |
| 6 | AI参照用サマリー基盤 | 4 | 2026-02-01 |

**進捗率**: 100% (34/34タスク) 🎊

### 修正ファイル

| ファイル | 主な変更 |
|----------|----------|
| SettingsModule.js | 許容損失・手法管理API追加 |
| entry-form-enhancement.js | リスク管理セクションUI |
| TradeEntry.js | 新フィールド保存 |
| TradeExit.js | 振り返り（ルール遵守）保存 |
| TradeList.js | バッジ表示（手法・リスク・ルール） |
| ReportModule.js | ルール遵守・リスク分析セクション |
| 6_responsive.css | スマホスクロール対応 |
| **AISummaryModule.js** | **新規作成（AI参照用サマリー基盤）** |

### AI機能への布石

```
【正しいAIの使い方】
生データ → Trading Completeが分析 → AI → 洞察
（コスト安い、精度高い、必要な時だけ課金）
```

AISummaryModule.jsでデータ分析の土台完成 → v2.0のAIアシスタントタブで活用予定

---

## 🎉 リリース時の構成（最終形）

**6タブ構成**:

| # | タブ | 機能 |
|---|------|------|
| 1 | 📝 新規エントリー | トレード入力、チェックリスト、チャート画像（3枚） |
| 2 | 📄 トレード記録 | 一覧、フィルター、詳細表示・編集・削除 |
| 3 | 📓 相場ノート | ノート作成、カレンダー表示、週次表示、**検索機能**、**月メモ機能** |
| 4 | 📊 分析 | Pips/円建て統計（切替）、レポート、チャート |
| 5 | 💰 収支管理 | 経費管理、入出金管理、締め処理、CSV出力 |
| 6 | ⚙️ 設定 | テーマ、ブローカー管理、お気に入り通貨ペア、データ管理 |

---

## ✅ 完了タスクサマリー

### 🔴 CRITICAL完了

| タスク | 完了日 | 詳細参照 |
|--------|--------|----------|
| **週次分析 上部・下部不一致修正** | **2025-12-22** | **REFERENCE.md** |
| 一括入力機能削除（統計整合性改善） | 2025-11-29 | REFERENCE.md |
| ノート保存バグ修正（#save()上書き問題） | 2025-11-27 | docs/フォーム制御.md |
| Part 4削除（script.js 2,266行削減） | 2025-11-27 | REFERENCE.md |
| Part 8: script.js削減（2,504行） | 2025-10-20 | REFERENCE.md |
| Part 8: 円建て統計・入出金管理追加 | 2025-10-28 | REFERENCE.md |
| 円建て損益保存バグ修正 | 2025-11-10 | docs/フォーム制御.md |
| タブ間数字統一（17,557円差分解消） | 2025-11-21 | docs/フォーム制御.md |
| **トレード分析強化（全6Phase完了）** | **2026-02-01** | **トレード分析強化_要件定義書_v1_16.md** |

### 🟡 HIGH完了

| タスク | 完了日 | 詳細参照 |
|--------|--------|----------|
| **MODULES.md準拠 全モジュール統一** | **2025-12-22** | **REFERENCE.md** |
| 設定タブ改善（全Phase完了） | 2025-11-26 | 設定タブ改善_要件定義書_v3_0.md |
| 経費一覧カテゴリアコーディオン | 2025-11-11 | REFERENCE.md |
| 分析タブレポート詳細バグ修正 | 2025-11-10 | REFERENCE.md |
| 経費サマリー自動更新 | 2025-11-11 | REFERENCE.md |

### 🟢 MEDIUM完了

| タスク | 完了日 | 詳細参照 |
|--------|--------|----------|
| **エントリー情報「編集」ボタン動作不具合** | **2025-12-23** | **REFERENCE.md** |
| **月次カレンダー ツールチップ位置修正** | **2025-12-23** | **REFERENCE.md** |
| 相場ノート エディタ機能強化 | 2025-12-21 | REFERENCE.md |
| GitHub Pages公開・品質改善 | 2025-12-17 | TASKS.md Week 7 |
| エクスポート/インポート拡張v7.0 | 2025-12-17 | REFERENCE.md |
| 分析タブ期間保持 | 2025-12-17 | REFERENCE.md |
| ライトモードCSS追加修正（モーダル・分析タブ・ヘッダー） | 2025-12-14 | REFERENCE.md |
| Netlify初回デプロイ | 2025-12-12 | TASKS.md Week 7 |
| ライトモードCSS完全対応 | 2025-12-12 | REFERENCE.md |
| レスポンシブ対応（全6タブ） | 2025-12-12 | REFERENCE.md |
| ChartModule レスポンシブ対応 | 2025-12-12 | REFERENCE.md |
| レスポンシブ週間プレビュー（アコーディオン機能） | 2025-12-11 | REFERENCE.md |
| 画像追加モーダルリニューアル | 2025-12-11 | REFERENCE.md |
| 画像表示統一（詳細モーダル・相場ノート） | 2025-12-11 | REFERENCE.md |
| 相場ノート機能改善（検索・月メモ） | 2025-11-27 | 相場ノート機能改善_要件定義書_v2_0.md |
| Part 3 NoteManagerModule化 | 2025-11-27 | REFERENCE.md |
| 月次カレンダー機能（Phase 1） | 2025-11-16 | 月次カレンダー機能_要件定義書_v1.5.md |
| 決済情報編集モーダルUI改善 | 2025-11-10 | docs/フォーム制御.md |
| 全期間チャートUI改善 | 2025-11-08 | REFERENCE.md |
| 新規エントリーフォーム問題4-5 | 2025-11-14 | docs/フォーム制御.md |

---

## ✅ 相場ノート機能改善（全Phase完了）

**完了日**: 2025-11-27 | **工数**: 約7h

| Phase | 内容 | 状態 |
|-------|------|------|
| 1 | データ層実装（NoteManagerModule拡張） | ✅ |
| 2 | HTML追加（検索ボタン・月メモUI・モーダル） | ✅ |
| 3 | CSS追加（3_notes.css, 5_themes.css, 6_responsive.css） | ✅ |
| 4 | JavaScript UI操作（12メソッド追加） | ✅ |
| 5 | バグ修正・統合テスト | ✅ |

**実装成果**:
- キーワード検索機能（モーダル、ハイライト表示）
- 月メモ機能（アノマリー：毎年共通、月次：年月別）
- 折りたたみ状態保存
- 日付選択⇔週間プレビュー完全連動

**修正したバグ**:
- ノート保存がリロードで消える（CRITICAL）
- 折りたたみアイコン（▲/▼）切替
- 日付変更時の月メモ更新
- 週間プレビュースクロール問題
- カレンダー⇔週間プレビュー連動

**詳細**: 相場ノート機能改善_要件定義書_v2_0.md

---

## ✅ 画像追加モーダル リニューアル

**完了日**: 2025-12-11 | **工数**: 2h | **優先度**: MEDIUM

**実装内容**:
- onclick属性 → addEventListener移行（堅牢性向上）
- 3択 → 2択に変更（保存先は設定で一括管理へ）
- ドラッグ＆ドロップ対応
- ImageAddModalModule.js として独立モジュール化（MODULES.md準拠）

**成果物**:
- 新規: `js/modules/ImageAddModalModule.js` (v1.0.1)
- 修正: `index.html`（HTML置き換え、スクリプト読み込み追加）
- 修正: `styles/4_features.css`（スタイル追加）
- 修正: `script.js`（旧関数3つ削除）

**削除した関数**:
- `selectStorageOption` - 3択UI廃止
- `processServerImage` - 「重要画像として保存」廃止
- `addExternalImage` - モジュールに移行

**新しいUI**:
- ドラッグ＆ドロップゾーン
- ファイル選択ボタン
- 外部URL入力欄
- ESCキー/背景クリックで閉じる

---

## ✅ 設定タブ改善（全Phase完了）

**完了日**: 2025-11-26 | **工数**: 約22h | **テスト**: 26/26 (100%)

| Phase | 内容 | 完了日 |
|-------|------|--------|
| 1 | サブタブ化 | 11/20 |
| 2 | ブローカー管理 | 11/20 |
| 3 | お気に入り通貨ペア | 11/22 |
| 4 | 新規エントリーフォーム改修 | 11/26 |
| 5-6 | EventBus統合・統合テスト | 11/26 |

**実装成果**: 3サブタブ、ブローカー25社+カスタム、お気に入り10件、オートコンプリート

**詳細**: 設定タブ改善_要件定義書_v3_0_全Phase完了版.md

---

## 🎯 リリース後のロードマップ

### 💳 サブスク機能（リリース後〜）

| 時期 | タスク |
|------|--------|
| リリース直後 | 無料版で運用開始 |
| ユーザー100人達成後 | Stripe連携・課金機能実装 |
| ユーザー500人達成後 | Pro/Premiumプラン提供開始 |

**料金プラン（予定）**:
- 無料: 基本機能
- Pro: ¥1,980/月
- Premium: ¥3,980/月

**詳細**: Trading_Complete_マーケティング実行チェックリスト.md

### v1.1-1.x: 継続的改善

| 時期 | タスク |
|------|--------|
| リリース後1ヶ月 | フィードバック収集、バグ修正 |
| リリース後3ヶ月 | 残りモジュール化、パフォーマンス最適化 |
| リリース後6ヶ月 | AI機能開発開始 |

### v2.0: 大型アップデート

- 新規エントリー×トレード記録統合
- AIアシスタントタブ追加

### v2.1: 機能拡張

- ✅ 月次カレンダー機能（Phase 1完了）
- ✅ 相場ノート検索・月メモ機能

### v3.0: グローバル展開 🌍

**ポイント**: Pipsは世界共通 → **表記変更のみでグローバル対応可能**

#### Phase 1: 基準通貨設定（1-2時間）
- JPY/USD/EUR切替
- 通貨記号・数値フォーマット変更

#### Phase 2: 多言語対応 i18n（3-5時間）
- 翻訳ファイル作成（js/i18n/translations.js）
- 翻訳関数 `t(key)` 実装
- 日本語/English切替

**市場拡大**: 日本10-20万人 → グローバル数百万人（10倍以上）

---

## 📊 進捗ダッシュボード

```
Part別モジュール化進捗:
Part 1: ────────── 対象外（基盤のため維持）
Part 2: ██████████ 100% ✅
bridge.js: ─────── 対象外（互換性レイヤーとして維持）
Part 3: ██████████ 100% ✅（NoteManagerModule完成 + 検索・月メモ機能）
Part 5: ██████████ 100% ✅（6ファイル完成）
Part 7: ██████████ 100% ✅（完全モジュール化）
Part 8: ██████████ 100% ✅（2,504行削減）

全体: █████████░ 90%（機能95%、構造90%）
```

**削減実績**: 7,737行
- Part 8: 2,504行
- Part 7: 600行
- Part 3: 1,400行
- Part 4削除（2025-10-28）: 744行
- Part 4削除（2025-11-27 script.js）: 2,266行
- 一括入力機能削除（2025-11-29）: 223行 ← NEW

**script.js行数**: 8,883行 → 5,029行（43%削減）

**※ Part 1（基盤・初期化）について**:
- storage, showToast, switchTab等のグローバル基盤
- 全モジュールが依存、モジュール化リスク高・メリット少のため現状維持

**※ bridge.js について**:
- 47関数が依存する互換性レイヤー
- 削除してもメリット少・リスクのみのため現状維持（削除予定なし）

---

## □ 未着手タスク

### リリース後追加機能

| タスク | 優先度 | 工数 | 備考 |
|--------|--------|------|------|
| **過去データ移行（テンプレートインポート）** | **MEDIUM** | **14h** | **要件定義済み、X反応次第で優先度UP** |

**詳細**: 過去データ移行_テンプレートインポート_要件定義書_v1_1.md

**概要**:
- Excel/スプレッドシートからTradingCompleteへの移行機能
- 3シート構成テンプレート（入力/お気に入り設定/マスターデータ）
- Pips自動計算、プルダウン選択、お気に入り登録
- 統計整合性を保った過去データ取り込み

### クリーンアップ（リリース後）

| タスク | 優先度 | 備考 |
|--------|--------|------|
| bridge.js削除 | LOW | リリース後v1.1推奨、47関数依存 |

### クラウド化後実装予定

| タスク | 優先度 | 備考 |
|--------|--------|------|
| ストレージ容量UI表示 | LOW | ローカル+クラウド統合UI、設定タブ>データ管理 |

### 未実装モジュール（将来）

| モジュール | 進捗 |
|-----------|------|
| NoteEditorModule | 未着手 |
| CalendarModule | 未着手 |
| AIPromptModule | 未着手 |

---

## 🐛 既知の問題

| 優先度 | 問題 | 回避策 |
|--------|------|--------|
| - | なし | - |

**解決済み**:
- ~~エントリー情報「編集」ボタン動作不具合~~ → localStorageのbrokersデータ形式検証・自動変換で解決（2025-12-23）
- ~~localStorage容量計算NaN~~ → 計算正常確認、UI未実装のみ（クラウド化後実装予定）（2025-12-11）
- ~~画像アップロード不安定~~ → ImageAddModalModule導入で解決（2025-12-11）

---

## 📋 ベータテスター管理

### Supabase Dashboard でのユーザー制御

**場所**: Supabase Dashboard → Authentication → Users

| 操作 | 方法 | 効果 |
|------|------|------|
| **Ban user** | ︙ → Ban user | ログイン不可（データは残る） |
| **Unban user** | ︙ → Unban user | ログイン再開 |
| **Delete user** | ︙ → Delete user | 完全削除 |

### ベータテスター運用フロー

```
テスト期間中 → 通常どおり使用可能
    ↓
テスト終了 → Ban user でログイン停止
    ↓
正式リリース後、課金したら → Unban で復活
```

### 注意事項

- Ban してもデータは削除されない
- Delete すると復元不可
- 将来的にはサブスクリプション連携で自動制御予定

---

## 📝 ドキュメント参照

### 開発ドキュメント

| ドキュメント | 内容 |
|-------------|------|
| **TASKS.md** | 機能開発タスク管理 |
| **MODULES.md** | 技術仕様・モジュール構成 |
| **OVERVIEW.md** | システム全体構造 |
| **REFERENCE.md** | 完了タスク詳細・教訓 |
| **docs/フォーム制御.md** | フォーム関連詳細・バグ修正履歴 |
| **機能一覧.md** | UI解説 |

### クラウド化・リリース

| ドキュメント | 内容 |
|-------------|------|
| **Supabase導入_ロードマップ_v2_3.md** | Supabase、セキュリティ、ドメイン設定 |
| **Trading_Complete_セキュリティ要件定義書_v1_5.md** | セキュリティ設計 |
| **Supabase_テーブル構造_Phase5_テスト完了版.md** | DBテーブル構造 |

### 分析強化

| ドキュメント | 内容 |
|-------------|------|
| **トレード分析強化_要件定義書_ロードマップ_v1_16_最終版.md** | 分析機能の設計・実装計画（完了） |

### マーケティング・収益化

| ドキュメント | 内容 |
|-------------|------|
| **Trading_Complete_マーケティング実行チェックリスト.md** | X運用、LINE、βテスト、サブスク |

*タスク完了時は即座にこのファイルを更新してください。*
